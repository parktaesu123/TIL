### CA(**Certificate Authority)**

> **인증서를 발급해주는 기관**
> 
- 클라이언트는 서버로부터 받은 공개키가 진짜인지 가짜인지 어떻게 판별 수 없다.
- **서버가 신뢰할 수 있는 진짜 서버 임을 확인**하기 위해 필요한 것이 바로 **`인증서`**이다. ****
- **TLS** 통신을 하려면 이 **CA**를 통해서 **`인증서`**를 발급받아야 한다.
- **CA는 자체적으로 공개키와 비밀키를 가지고 있다.**

**인증서에 포함되어 있는 정보**

<aside>

1. 서비스 정보(인증서를 발급한 CA, 서비스의 도메인 등)

2. 서버 측 공개키(공개키, 공개키 암호화 방법)

3. 지문, 디지털 서명 등

</aside>

### CA로부터 인증서를 발급받는 방법

- 발급 받고자 하는 기관은 자신의 **사이트 정보(도메인 등)**과 **공개키**를 CA에게 제출
- CA는 검증을 걸친 후 **발급 받고자 하는 기관의 공개 키를 해시(SHA-256 등)한다.**
    - 해시한 값을  **`Finger Print(지문)`이라고 한다.**
- 지문을 **CA의 비밀키로 암호화** 하고, 인증서의 발급자 서명으로 등록한다.
    - 이렇게 서명된 것을   **`디지털 서명 (Digital Signing)`이라고 한다.**
- CA는 서버에게 이 **디지털 서명, 발급자 정보 등등이 등록되어 있는** **인증서를 발급해준다.**

<aside>

위 방식 처럼 **상위 인증 기관이 하위 인증서가 포함하고 있는 공개키 (인증서)를 상위 기관의 비밀키로 암호화하여** 상호 보증하게 되는 것을  **인증서  체인(Certificate Chain)이라고 한다.**

</aside>

### 인증서 체인

1. **tistroty.com의 인증서**는 그 상위 인증서인 **Thawte TLS RSA CA G1의 인증기관(Intermediate CA)의 비밀키로 암호화** 된 것이며,
2. **Thawte TLS RSA CA G1 인증서**는 그 상위 인증서인**DigiCert Global Root G2의 인증기관의 비밀키로 암호화** 된 것이다.
3. **DigiCert Global Root G2**는 **상위 인증기관이 없는 Root CA**이기 때문에 **Self-Signed** 되어 있어요.

 **Self-SIgned (스스로 보증)**

> **자신의 인증서를 해시한 후, CA가 아닌 자신의 비밀키로 암호화 하여 서명으로 등록**
> 
> 
> 하는 것
> 

### **인증서로 서버를 인증하는 방법**

---

- CA에서 발급받은 인증서를 통해 서버의 신뢰성을 인증한다

> 클라이언트는 **`인증서`**가 CA에서 발급받은 것인지,  조작된 것인지 어떻게 확인 할까???
> 
- **클라이언트들은 CA 리스트를 이미 갖고있다.**
    - OS를 설치할 때 PC에 포함되거나 브라우저가 포함하고 있다.
    - CA 리스트란, 공인으로 인증된 CA기관들의 리스트들로, 그들의 **공개키**도 함께 갖고 있다.

서버가 CA에서 발급 받은 자신의 **`인증서`**를 클라이언트에게 전달하고,

클라이언트는 이 **`인증서`**가 자신이 가진 CA 리스트에 있는 기관에서 발급받은 것인지 확인한다.

확인이 완료 되면 CA 기관의 공개키로 서버 인증서의 **`서명(Digital Signing)`**을 복호화한다.

**디지털 서명을 CA 기관의 공개키로 복호화 하여 나온 해시 값과**

**공개키를 해시한 값(지문)**이 일치 한다면, **인증서가 위조되지 않았음을 인증**하는 것이다.

> 만약, 인증서의 공개키가 임의로 수정된 값이라면
> 
> 
> 이 공개키를 해시한 값은 서명을 복호화한 값(원본 공개키의 해시 값)과 전혀 다른 값이 나온다.
> 
> 이런 방식으로 서버 인증서의 무결성을 검증할 수 있다
> 

클라이언트는 이제 서버가 CA 인증기관에서 인증받은 신뢰할 수 있는 서버임을 알았다

또한 인증서 안에 들어 있는 서버의 공개키도 알았다.

이제 서로 통신을 주고받기 위해 클라이언트는 자신이 사용할 '대칭키'를 **TLS 암호화 방식 통해** 서버에게 전달해 줘야 한다.

### 참고자료

https://babbab2.tistory.com/5

https://m.blog.naver.com/alice_k106/221468341565
