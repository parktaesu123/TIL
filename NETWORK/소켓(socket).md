## 소켓(sockek)이란?

<aside>

💡 **소켓(Socket)**은 네트워크 통신에서 데이터를 주고받기 위한 **종착점(endpoint)**이다.

</aside>

- 클라이언트와 서버가 데이터를 주고받는 데 사용된다.
- **`OSI 7계층`** 중 응용 계층에 속하는 **프로세스**들은 데이터 송수신을 위해 반드시 **소켓**을 거쳐 전송 계층으로 데이터를 전달해야한다。
- 소켓은 전송 계층과 응용 프로그램 사이의 **인터페이스 역할**을 하며 떨어져 있는 두 호스트를 연결해준다.

**소켓의 구성요소**

- **`프로토콜`**
    - 네트워크 통신을 위해 사용되는 **규칙**
    - **TCP**와 **UDP**
- **`IP`**
    - **IP 주소**는 네트워크 상에서 장치의 위치를 나타내는 **고유 식별자이다.**
    - 주소를 통해 데이터를 어디로 보내야 할지 알 수있다.
- **`포트 번호`**
    - 포트 번호는 통신을 사용하는 어플리케이션을 식별하는 번호이다.
    - **같은 컴퓨터 내에서 프로그램을 식별하는 번호이다.

> **소켓**은 두 컴퓨터가 데이터를 주고받을 때 사용하는 상자로 볼 수있다. **`데이터(물건)`**를 주고받기 위해선 **`상자(소켓)`**를 준비해야 하는 것처럼, 통신을 하기 위해선 먼저 **소켓**을 만들어야 한다.
IP 주소는 **택배를 보낼 컴퓨터의 위치**를 의미한다. IP주소를 통해 어느 집(컴퓨터)으로 택배를 보낼지 알 수 있다.
포트 번호는 그 집에서 택배를 받을 우편함(특정 프로그램)을 정해준다. 즉, 특정 컴퓨터의 특정 프로그램이 데이터를 받기 위해 대기하고 있는 자리이다.
> 

### 소켓의 종류

---

**TCP(Transmission Control Protocol) / 스트림 소켓(Stream Socket)**

- **연결지향 방식**이다.
- 신뢰성있는 데이터 전송을 제공한다.
    - 데이터는 순서대로 전송되고, 손실이 발생하면 **재전송**된다.
- 대부분의 네트워크 애플리케이션은 **`스트림 소켓`**을 사용한다.
- 소량의 데이터보다 대량 데이터 전송에 적합하다.

**UDP 소켓 / 데이터그램 소켓(Datagram Socket)**

- **비연결 지향 방식**이다.
- 비신뢰성 데이터 전송을 제공한다.
    - 데이터는 **개별적인 데이터그램**으로 전송되며, 순서 보장이나 재전송 기능이 없다.
- 실시간 전송이 중요한 경우(예: 스트리밍, 온라인 게임) 사용된다.

*~~(TCP와 UDP는 다른 페이지에서 깊이 파보도록 하자)~~*

### 양방향 통신

---

> 클라이언트단과 서버단이 서로 연결되어 있을때 **양방향**(클라이언트 -> 서버, 서버 -> 클라이언트) 으로 요청을 보내 통신을 할 수 있게 해주는 것
> 
- **TCP통신**에서는 소켓을 이용한 연결방식을 사용한다.
    - 양방향 통신이 가능하다.
- 클라이언트단과 서버단의 연결이 끊어지지않고 계속 연결을 유지해주어 실시간 소통이 가능하다.

## 소켓의 통신과정

---

**서버(server)**

> **클라이언트 소켓**의 연결 요청을 대기하고, 연결 요청이 오면 클라이언트 소켓을 생성하여 통신이 가능하게 한다
> 
1. **`socket()`** 함수를 이용하여 소켓을 생성한다.
2. **`bind()`** 함수로 **ip**와 **port** 번호를 설정한다.
3. **`listen()`** 함수로 클라이언트의 접근 요청에 수신 대기열을 만들어 몇 개의 클라이언트를 대기 시킬지 결정한다.
4. **`accept()`** 함수를 사용하여 클라이언트와의 연결을 기다린다.

**클라이언트(client)**

> 실제로 데이터 송수신이 일어나는 것은 **클라이언트 소켓**이다.
> 
1. **`socket()`** 함수로 가장 먼저 소켓을 연다.
2. **`connect()`** 함수를 이용하여 통신 할 서버의 설정된 **ip**와 **port** 번호에 통신을 시도한다.
3. 통신을 시도 시, 서버가 **`accept()`** 함수를 이용하여 **새로운 소켓(자식 소켓)**을 생성하고 클라이언트의 **socket descriptor**를 반환한다. (socket descriptor는 통신에 사용되는 고유한 식별자) **원래 서버 소켓(부모 소켓)**은 계속해서 다른 클라이언트의 연결 요청을 대기하고, **자식 소켓**은 연결된 클라이언트와 통신을 전담하게 된다.
4. 이를 통해 클라이언트와 서버가 서로 **`read()`**, **`write()`** 를 하며 통신한다. (이 과정이 반복된다.)

### **`read()`와 `write()` 함수**

---

> **서버와 클라이언트가 서로 데이터를 주고받기 위해 호출하는 함수**
> 

**`write()` 함수: 데이터 전송**

- **`write()`**는 **데이터를 상대방에게 보내는 함수이다.**
- 이때, 데이터를 보내는 쪽에서는 **상대방의 소켓 디스크립터**를 통해 특정 클라이언트나 서버를 식별해 데이터를 전송할 수 있다.

**`read()` 함수: 데이터 수신**

- **`read()`**는 **상대방으로부터 데이터를 읽어오는 함수**로, 이 함수도 소켓 디스크립터를 사용해 데이터를 받을 상대방을 식별한다.
- 클라이언트와 서버는 서로가 보낸 데이터를 수신하고 읽어들이며 필요한 처리를 할 수 있다.

<aside>

**위 함수들이 반복 호출되면서 서버와 클라이언트는 양방향 통신을 지속하며 데이터를 교환한다. 예를 들어, 클라이언트가 `write()`로 서버에 요청을 보내면 서버는 `read()`로 해당 데이터를 수신하고, 이후 서버는 처리 결과를 다시 `write()`로 클라이언트에 응답할 수 있다.**

</aside>

<aside>

**소켓 통신의 과정 ex) 택배 과정** 📦

- **소켓 준비하기**: 먼저 택배를 보내기 위해 택배 상자를 준비하듯이, 서버와 클라이언트는 소켓을 준비한다.
- **연결 요청하기**: 클라이언트는 택배를 보낼 사람처럼 상자에 넣을 데이터를 준비하고, 상대방 컴퓨터(주소)와 포트 번호(우편함)에 연결해달라고 요청한다.
- **연결 수락하기**: 서버는 이 요청을 받아들여서 연결을 수락한다. 즉, 택배를 받을 준비를 한다.
- **데이터 전송**: 연결이 되면 클라이언트는 서버에게 데이터를 보내고, 서버도 필요하면 클라이언트에게 데이터를 보내면서 서로 주고 받는다.
- **연결 종료하기**: 통신이 끝나면 서로 연결을 종료한다. 마치 택배를 모두 주고받은 후 상자를 정리하는 것처럼
</aside>

### 참고자료

https://play-with.tistory.com/313

https://velog.io/@newdana01/%EC%86%8C%EC%BC%93%EC%9D%B4%EB%9E%80-%EC%A2%85%EB%A5%98-%ED%86%B5%EC%8B%A0-%ED%9D%90%EB%A6%84-HTTP%ED%86%B5%EC%8B%A0%EA%B3%BC%EC%9D%98-%EC%B0%A8%EC%9D%B4

https://shg-engineer.tistory.com/21

https://helloworld-88.tistory.com/215

https://sooolog.dev/HTTP-%ED%86%B5%EC%8B%A0%EA%B3%BC-TCP-%ED%86%B5%EC%8B%A0-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%9B%B9-%EC%86%8C%EC%BC%93%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90-%EC%A0%95%EB%A6%AC/
